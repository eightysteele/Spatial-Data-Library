# Examples:
# Command line to get variables for worldclim tile 21:
./sdl.py -c getworldclimtile -k 21 -v /home/tuco/Data/SDL/worldclim/21 -w /home/tuco/SDL/workspace

# Command line to load tile 21 (requires that getworldclimtile has been run for the tile
./sdl.py -c load -v /home/tuco/Data/SDL/worldclim/21 -w /home/tuco/SDL/workspace -u http://eighty.berkeley.edu:5984 -d worldclim-rmg -g /home/tuco/SDL/Spatial-Data-Library/data/gadm/Terrestrial-10min-buffered_00833.shp -k 21 -f -150,30 -t -120,0 -n 120 -b 25000 -l sdl-load-tile21.log > /home/tuco/SDL/workspace/tile21starspan.log &

#Command line to fully process tile 38 to its own CouchDB database. Database must exist in advance. Put the starspan output in its own file:
./sdl.py -c full -v /home/tuco/Data/SDL/worldclim/38 -w /home/tuco/SDL/workspace -u http://eighty.berkeley.edu:5984 -d worldclim-rmg-38 -g /home/tuco/SDL/Spatial-Data-Library/data/gadm/Terrestrial-10min-buffered_00833.shp -k 38 -f 60,0 -t 30,-30 -n 120 -b 25000 > /home/tuco/SDL/workspace/tile37starspan.log &

./sdl.py -c full -v /home/tuco/Data/SDL/worldclim/32 -w /home/tuco/SDL/workspace -u http://eighty.berkeley.edu:5984 -d worldclim-rmg-32 -g /home/tuco/SDL/Spatial-Data-Library/data/gadm/Terrestrial-10min-buffered_00833.shp -k 32 -f 60,0 -t 30,-30 -n 120 -b 50000 > /home/tuco/SDL/workspace/tile32starspan.log &

#Command line to load tile 12 with logging:
./sdl.py -c load -v /home/tuco/Data/SDL/worldclim/12 -w /home/tuco/SDL/workspace -u http://eighty.berkeley.edu:5984 -d worldclim-rmg -g /home/tuco/SDL/Spatial-Data-Library/data/gadm/Terrestrial-10min-buffered_00833.shp -k 12 -f -120,60 -t -90,30 -n 120 -b 25000 > /home/tuco/SDL/workspace/tile12load.log &

#CouchDB views

#For the API
_design/api/cells
function(doc) {
  emit(doc._id, {rev:doc._rev, coords:doc.coords, varvals:doc.vars});
}

#To isolate cells having values = 0 for all variables
_design/sdl/zerovals
function(doc) {
  if(doc.vars.tmax12 && doc.vars.tmin12){
    if(doc.vars.tmax12 === "0" && doc.vars.tmin12 === "0"){
      emit(doc._id, doc._rev);
    }
  }
}